ipeline {
    agent none
    parameters {
        booleanParam ( name: 'UNITTEST', defaultValue: true, description:'Enable unit test?')
    }
    stages {
        stage ('Checkout') {
            agent { label 'demo'}
            steps {
                git branch: 'master', url:'https://github.com/rmogalipuvvu/pipelinejenkins_repo.git'
            }
        }
       stage('PreCheck') {
           agent { label 'demo' }
            steps {
                script {
                    env.BUILDME ='yes' // Set env variable to set further Build Stages
                }
            }
       }
       
           stage ( 'Build Artifacts') {
           agent { label 'demo' }
           when { environment name: 'BUILDME', value: 'yes'}
           steps {
               script {
               if(params.UNITTEST) {
                   unitstr = "" }
                   else  {
                       unitstr = "-Dmaven.test.skip=true"
                    }
               }                
               echo 'Building Jar Component'
               dir ( "./samplejar" ) {
               sh "mvn clean package ${ unitstr }"
               }
               echo 'Building War component'
               dir ( "./samplewar" ) {
                  sh "mvn clean package" 
               }
           }
       }
    }
}       
